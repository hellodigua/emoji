<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¡¨æƒ…åŒ…æ ‡ç­¾ç³»ç»Ÿ V3 (è‡ªåŠ¨åŠ è½½ç‰ˆ)</title>
    <style>
      /* CSSæ ·å¼ä¸ä¹‹å‰ç‰ˆæœ¬ç›¸åŒï¼Œä¿æŒä¸å˜ */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f7fafc;
        color: #2d3748;
        padding: 2rem;
        line-height: 1.6;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      h1,
      h2 {
        color: #2c5282;
        border-bottom: 2px solid #e2e8f0;
        padding-bottom: 0.5rem;
        margin-top: 2rem;
      }
      button {
        background-color: #4299e1;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.2s;
      }
      button:hover {
        background-color: #2b6cb0;
      }
      .instructions {
        margin: 2rem 0;
        background: #fff;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }
      .platform-section {
        margin-top: 2rem;
      }
      .emoji-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
      }
      .emoji-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 1rem;
        border: 1px solid #e2e8f0;
      }
      .emoji-preview {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }
      .emoji-preview img {
        width: 60px;
        height: 60px;
        flex-shrink: 0;
      }
      .desc-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }
      .desc-label {
        font-size: 14px;
        font-weight: 600;
        color: #2d3748;
        margin: 0;
      }
      .desc-input {
        padding: 8px;
        border: 1px solid #cbd5e0;
        border-radius: 4px;
        font-size: 14px;
      }
      .form-group {
        margin-bottom: 1rem;
      }
      .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-size: 14px;
      }
      .form-group input[type="text"] {
        width: calc(100% - 16px);
        padding: 8px;
        border: 1px solid #cbd5e0;
        border-radius: 4px;
      }
      .tag-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        padding-top: 0.25rem;
      }
      .tag-group label {
        display: flex;
        align-items: center;
        font-size: 13px;
        cursor: pointer;
        padding: 4px 10px;
        border: 1px solid #e2e8f0;
        border-radius: 20px;
        user-select: none;
      }
      .tag-group input {
        margin-right: 5px;
      }
      .tag-category {
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
      }
      .tag-category-title {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 0.25rem;
        font-size: 14px;
      }
      .tag-category-desc {
        font-size: 12px;
        color: #718096;
        margin-bottom: 0.75rem;
      }
      #output-area {
        margin-top: 3rem;
      }
      #output-json {
        width: 100%;
        height: 400px;
        font-family: monospace;
        background-color: #edf2f7;
        border: 1px solid #cbd5e0;
        border-radius: 5px;
        padding: 1rem;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>è¡¨æƒ…åŒ…åœ¨çº¿å‘½å & æ‰“æ ‡ç­¾å·¥å…· (V3)</h1>

      <div class="instructions">
        <h2>ä¸‰è½´æ ‡ç­¾ä½“ç³»è¯´æ˜</h2>
        <p><strong>æƒ…æ„Ÿè½´</strong>ï¼šè¡¨æƒ…ä¼ é€’çš„æ ¸å¿ƒæƒ…ç»ªè‰²å½© - positive(ç§¯æ)ã€negative(æ¶ˆæ)ã€neutral(ä¸­æ€§)</p>
        <p><strong>æ„å›¾è½´</strong>ï¼šä½¿ç”¨è¡¨æƒ…çš„ç›®çš„å’Œæ„å›¾ - praise(èµç¾)ã€agree(èµåŒ)ã€question(ç–‘é—®)ã€celebrate(åº†ç¥)ã€comfort(å®‰æ…°)ã€refute(åé©³)ã€show-off(ç‚«è€€)</p>
        <p><strong>é£æ ¼è½´</strong>ï¼šæƒ…ç»ªå’Œæ„å›¾çš„è¡¨è¾¾æ–¹å¼ - funny(æç¬‘)ã€irony(åè®½)ã€cute(å¯çˆ±)ã€exaggerate(å¤¸å¼ )ã€shy(å®³ç¾)</p>
        <p style="color: #718096; font-size: 14px;">ğŸ’¡ æ¯ä¸ªè½´éƒ½å¯ä»¥å¤šé€‰ï¼Œä¸€ä¸ªè¡¨æƒ…å¯ä»¥åŒæ—¶å…·æœ‰å¤šä¸ªç»´åº¦çš„ç‰¹å¾</p>
      </div>

      <div id="tagging-root"></div>

      <div id="output-area">
        <h2><strong>æœ€åä¸€æ­¥</strong>ï¼šç”Ÿæˆå¹¶ä¸‹è½½å¸¦æœ‰æ ‡ç­¾çš„JSON</h2>
        <button id="generate-btn">ç”Ÿæˆå¹¶ä¸‹è½½ tagged_emoji.json</button>
        <p style="margin-top: 1rem">æœ€ç»ˆç”Ÿæˆçš„JSONé¢„è§ˆï¼š</p>
        <textarea id="output-json" readonly></textarea>
      </div>
    </div>

    <script>
      // --- 1. å®šä¹‰æ‰€éœ€å˜é‡å’Œé¢„è®¾æ ‡ç­¾ ---
      const taggingRoot = document.getElementById("tagging-root");
      const generateBtn = document.getElementById("generate-btn");
      const outputJsonTextarea = document.getElementById("output-json");

      const tagCategories = {
        sentiment: {
          title: "æƒ…æ„Ÿè½´",
          description: "è¡¨æƒ…ä¼ é€’çš„æ ¸å¿ƒæƒ…ç»ªè‰²å½©",
          tags: [
            { value: "positive", label: "ç§¯æ" },
            { value: "negative", label: "æ¶ˆæ" },
            { value: "neutral", label: "ä¸­æ€§" }
          ]
        },
        intent: {
          title: "æ„å›¾è½´", 
          description: "ä½¿ç”¨è¡¨æƒ…çš„ç›®çš„å’Œæ„å›¾",
          tags: [
            { value: "praise", label: "èµç¾" },
            { value: "agree", label: "èµåŒ" },
            { value: "question", label: "ç–‘é—®" },
            { value: "celebrate", label: "åº†ç¥" },
            { value: "comfort", label: "å®‰æ…°" },
            { value: "refute", label: "åé©³" },
            { value: "show-off", label: "ç‚«è€€" }
          ]
        },
        style: {
          title: "é£æ ¼è½´",
          description: "æƒ…ç»ªå’Œæ„å›¾çš„è¡¨è¾¾æ–¹å¼",
          tags: [
            { value: "funny", label: "æç¬‘" },
            { value: "irony", label: "åè®½" },
            { value: "cute", label: "å¯çˆ±" },
            { value: "exaggerate", label: "å¤¸å¼ " },
            { value: "shy", label: "å®³ç¾" }
          ]
        }
      };

      let emojiData = [];

      // --- 2. é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–å’Œæ¸²æŸ“æ•°æ® ---
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const response = await fetch("emoji.json");
          if (!response.ok) {
            throw new Error(
              `HTTP error! status: ${response.status}. è¯·ç¡®ä¿ emoji.json æ–‡ä»¶ä¸æ­¤htmlåœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œå¹¶ä¸”æ‚¨æ­£åœ¨ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨è®¿é—®ã€‚`
            );
          }
          emojiData = await response.json();
          renderTaggerUI();
        } catch (err) {
          taggingRoot.innerHTML = `<p style="color: red;"><strong>åŠ è½½å¤±è´¥ï¼š</strong>${err.message}</p>`;
          console.error(err);
        }
      });

      // --- 3. æ¸²æŸ“UIç•Œé¢çš„å‡½æ•° (ä¸ä¹‹å‰ç‰ˆæœ¬ç›¸åŒ) ---
      function renderTaggerUI() {
        emojiData.forEach((platformData, platformIndex) => {
          const section = document.createElement("div");
          section.className = "platform-section";

          const title = document.createElement("h2");
          title.textContent = `å¹³å°ï¼š${platformData.platform}`;
          section.appendChild(title);

          const grid = document.createElement("div");
          grid.className = "emoji-grid";

          platformData.emojis.forEach((emoji, emojiIndex) => {
            const card = document.createElement("div");
            card.className = "emoji-card";
            const preview = document.createElement("div");
            preview.className = "emoji-preview";
            const img = document.createElement("img");
            img.src = emoji.url;
            img.alt = emoji.description || emoji.url;
            
            const descContainer = document.createElement("div");
            descContainer.className = "desc-container";
            const descLabel = document.createElement("label");
            descLabel.textContent = "åç§°";
            descLabel.className = "desc-label";
            const descInput = document.createElement("input");
            descInput.type = "text";
            descInput.value = emoji.description;
            descInput.className = "desc-input";
            descInput.oninput = (e) => {
              emojiData[platformIndex].emojis[emojiIndex].description =
                e.target.value;
              updateJsonPreview();
            };
            descContainer.appendChild(descLabel);
            descContainer.appendChild(descInput);
            
            preview.appendChild(img);
            preview.appendChild(descContainer);

            const tagsGroup = document.createElement("div");
            tagsGroup.className = "form-group";
            const tagsLabel = document.createElement("label");
            tagsLabel.textContent = "æ ‡ç­¾åˆ†ç±» (Tag Categories)";
            tagsGroup.appendChild(tagsLabel);

            Object.entries(tagCategories).forEach(([categoryKey, category]) => {
              const categoryDiv = document.createElement("div");
              categoryDiv.className = "tag-category";
              
              const categoryTitle = document.createElement("div");
              categoryTitle.className = "tag-category-title";
              categoryTitle.textContent = category.title;
              
              const categoryDesc = document.createElement("div");
              categoryDesc.className = "tag-category-desc";
              categoryDesc.textContent = category.description;
              
              const tagsContainer = document.createElement("div");
              tagsContainer.className = "tag-group";

              category.tags.forEach((tag) => {
                const label = document.createElement("label");
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.value = tag.value;
                if (emoji.tags.includes(tag.value)) {
                  checkbox.checked = true;
                }
                checkbox.onchange = (e) => {
                  const currentTags = new Set(
                    emojiData[platformIndex].emojis[emojiIndex].tags
                  );
                  if (e.target.checked) {
                    currentTags.add(tag.value);
                  } else {
                    currentTags.delete(tag.value);
                  }
                  emojiData[platformIndex].emojis[emojiIndex].tags =
                    Array.from(currentTags);
                  updateJsonPreview();
                };
                label.appendChild(checkbox);
                label.append(tag.label);
                tagsContainer.appendChild(label);
              });

              categoryDiv.appendChild(categoryTitle);
              categoryDiv.appendChild(categoryDesc);
              categoryDiv.appendChild(tagsContainer);
              tagsGroup.appendChild(categoryDiv);
            });

            card.appendChild(preview);
            card.appendChild(tagsGroup);
            grid.appendChild(card);
          });

          section.appendChild(grid);
          taggingRoot.appendChild(section);
        });

        updateJsonPreview();
      }

      // --- 4. æ›´æ–°é¢„è§ˆå’Œç”Ÿæˆä¸‹è½½ (ä¸ä¹‹å‰ç‰ˆæœ¬ç›¸åŒ) ---
      function updateJsonPreview() {
        outputJsonTextarea.value = JSON.stringify(emojiData, null, 2);
      }

      generateBtn.addEventListener("click", () => {
        if (emojiData.length === 0) {
          alert("æ•°æ®æœªåŠ è½½ï¼Œæ— æ³•ç”Ÿæˆï¼");
          return;
        }
        const jsonString = JSON.stringify(emojiData, null, 2);
        const blob = new Blob([jsonString], { type: "application/json" });
        const url = URL.createObjectURL(blob);

        const link = document.createElement("a");
        link.href = url;
        link.download = "tagged_emoji.json";

        document.body.appendChild(link);
        link.click();

        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      });
    </script>
  </body>
</html>
